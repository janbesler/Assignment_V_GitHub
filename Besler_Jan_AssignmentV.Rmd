---
title: "Besler_Jan_AssignmentV"
author: "Jan Besler"
date: "13/02/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## API Ticketmaster
First we look at the documentation of the Ticketmaster API (https://developer.ticketmaster.com/products-and-docs/apis/getting-started/) to get the necessary information on how the database is structured and what the "rules" are, e.g. rate limits and ToS.
The rate limit shown on the page lies at 5000 calls per day as of 13/02/2021.

```{r api}
A5_key <- source("~/.eigenwerke/api/api_assignment5.R")

```

## API key
The API key is a publicly available on the API Explorer (https://developer.ticketmaster.com/api-explorer/v2/) and is stored separately on a file on a local machine. Next we prepare the required libraries for the API and its usage on plots etc.

```{r packages, echo=FALSE}
#install.packages("jsonlite")
#install.packages("httr")
#install.packages("rlist")

library(ggplot2)
library(tidyr)
library(dplyr)
library(jsonlite)
library(httr)
library(rlist)
```

## basic API Interaction
In the first step the results from the first site are printed and are compiled into a data frame.
The output looks like this:

``` {r api_basic}
res_venue <- GET(url  = "https://app.ticketmaster.com/discovery/v2/venues.json?",
                    query = list(apikey = A5_key[1],
                                 countryCode = "DE"))
content_venue_DE <- jsonlite::fromJSON(content(res_venue, as = "text"))
df_venue_De <- data.frame(content_venue_DE$'_embedded'$venues)
df_venue_DE <- subset(df_venue_De, select = c(1,8,10,12,5,13), drop = FALSE)
```

IF we use the content function on the venue data for Germany we get a list of 3 containing further lists with the names "_embedded", "_links" and "page". The last one is showing metainformation on the performed GET-request and contains the size, number of elements and number of pages. While the object "_links" contains used links to get the information, for example the link for the first and last entry in the database. The first object is a list itself as well and contains the actually desired information for the first 20 venues in Germany with all the respective information stored in the database.

##API advanced

Since the first basic step only shows the results for the first 20 results, hence the first site. The following part is resolving this problem by iterating the pagenumbers until there are less than 20 values on a page.

``` {r api_advanced}



```